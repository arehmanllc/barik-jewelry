{% comment %} Editorial Columns Assets {% endcomment %}
{{ 'section-multicolumn.css' | asset_url | stylesheet_tag: preload: true }}

{% comment %} Editorial Columns Logic {% endcomment %}
{%- liquid

  assign section_padding = ''
  if section.settings.section_padding == 'top'
    assign section_padding = 'pb0'
  elsif section.settings.section_padding == 'bottom'
    assign section_padding = 'mt0'
  elsif section.settings.section_padding == 'none'
    assign section_padding = 'mt0 pb0'
  endif

  assign sm_render = '100vw'
  assign md_render = 'calc(100vw / ' | append: section.blocks.size | append: ')'
  assign lg_render = 'calc(100vw / ' | append: section.blocks.size | append: ')'

  if section.index == 1
    assign loading = 'eager'
    assign fetch_priority = 'high'
  endif

-%}

{% comment %} Multicolumn section {% endcomment %}
<div
  class="section-multicolumn multicolumn-{{ section.id }} global__section {{ section_padding }} {% if request.visual_preview_mode %}preview-mode{% endif %}"
  data-section-id="{{ section.id }}"
  data-section-type="multicolumn"
  data-section-loaded="false">

  <div class="section-multicolumn__inner-wrapper grid__wrapper">

    {% for block in section.blocks %}

      {% liquid

        case block.settings.block_width
          when 'one_third'
            assign block_width = 'span-4'
          when 'half'
            assign block_width = 'span-6'
          when 'two_thirds'
            assign block_width = 'span-8'
          when 'full'
            assign block_width = 'span-12'
        endcase

        assign text_align = block.settings.text_align

        assign heading = block.settings.heading
        assign caption = block.settings.caption
        assign button_text = block.settings.button_text
        assign link = block.settings.link

        assign has_button = false
        if link != blank and button_text != blank
          assign has_button = true
        endif

        assign has_caption = false
        if heading != blank or caption != blank or link != false
          assign has_caption = true
        endif

        assign has_image = false
        unless block.type == 'text'
          assign image = block.settings.image
          if image != blank
            assign has_image = true
          endif
          case block.settings.image_height
            when 'natural'
              assign image_height = 'mc--image_natural'
            when 'small'
              assign image_height = 'mc--image_small'
            when 'medium'
              assign image_height = 'mc--image_medium'
            when 'large'
              assign image_height = 'mc--image_large'
          endcase
        endunless

        if block.type == 'image_floating_text'
          assign text_position = block.settings.text_position
          assign caption_background_fill = false
          if block.settings.caption_background_fill
            assign caption_background_fill = true
          endif
        endif

        assign two_rows = false
        if block.settings.two_rows
          assign two_rows = true
        endif

        case block.type
          when 'image_alongside_text'
            assign image_width = 'span-6 auto sm-span-12'
            assign classes = 'py4 px4 sm-px3 span-6 auto sm-span-12 cg0 a-' | append: text_align
          when 'image_above_text'
            assign image_width = 'span-12 auto sm-span-12'
            assign classes = 'py4 span-12 auto sm-span-12 a-' | append: text_align
            if block.settings.color_scheme != 'none'
              assign classes = classes | prepend: 'px4 '
            endif
          when 'image_floating_text'
            assign image_width = 'span-12 auto sm-span-12'
            assign classes = 'py4 px4 span-12 auto sm-span-12 a-' | append: text_align | append: ' ' | append:  text_position
          when 'text'
            assign classes = 'py4 span-12 auto sm-span-12 a-' | append: text_align
            if block.settings.color_scheme != 'none'
              assign classes = classes | prepend: 'px4 '
            endif
        endcase
      %}

      {% style %}
        {% unless block.settings.color_scheme == 'none' %}
          .section-multicolumn__item.block-{{ block.id }} .multicolumn--item_container {
            background: var(--scheme-{{ block.settings.color_scheme }}-bg) !important;
          }
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content h1,
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content h2,
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content h3,
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content h4,
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content h5,
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content h6,
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content p,
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content a:not(.button),
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content a:not(.button):visited,
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__content .rte {
            color: var(--scheme-{{ block.settings.color_scheme }}-text) !important;
          }
        {% endunless %}

        {% if block.type == 'image_floating_text' %}
          {% assign block_opacity = block.settings.overlay_opacity | plus: 0 | divided_by: 100.0%}
          .multicolumn--image_floating_text.block-{{ block.id }} {
            --section-overlay-color: {{ block.settings.overlay_color | color_modify: 'alpha', block_opacity }};
          }
          {% if caption_background_fill and block.settings.color_scheme != 'none' %}
            .multicolumn--image_floating_text.block-{{ block.id }} .section-multicolumn__content {
                background: var(--scheme-{{ block.settings.color_scheme }}-bg) !important;
            }
          {% elsif caption_background_fill and block.settings.color_scheme == 'none' %}
            .multicolumn--image_floating_text.block-{{ block.id }} .section-multicolumn__content {
                background: var(--background);
              }
          {% endif %}
        {% endif %}

        {% if block.type == 'image_alongside_text' and block.settings.image_align == 'right' %}
          .multicolumn--{{ block.type }}.block-{{ block.id }} .section-multicolumn__image {
            order: 1;
          }
        {% endif %}

      {% endstyle %}

      <article class="section-multicolumn__item multicolumn--{{ block.type }} block-{{ block.id }}{% if two_rows %} r-span-2{% endif %} {{ block_width }} auto sm-span-12 rg0 animate--text delay--{{ forloop.index }}" {{ block.shopify_attributes }}>

        <div class="grid__wrapper grid__wrapper edge rg0 multicolumn--item_container">
          {% if has_image %}
            <div class="section-multicolumn__image {{ image_width }} {{ image_height }}">
              {% if link != blank %}<a href="{{ block.settings.link }}">{% endif %}
                {% render 'helper-image',
                  type: block.settings.image,
                  sm_render: sm_render,
                  md_render: md_render,
                  lg_render: lg_render,
                  loading: loading,
                  fetchpriority: fetch_priority %}
              {% if link != blank %}</a>{% endif %}
            </div>
          {% elsif has_image == false and block.type != 'text' %}
            <div class="section-multicolumn__image demo-1  onboard {{ image_width }} {{ image_height }}">
              {% if link != blank %}<a href="{{ block.settings.link }}">{% endif %}
              {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
              {% if link != blank %}</a>{% endif %}
            </div>
          {% endif %}

          {% if has_caption %}
            <div class="section-multicolumn__content {{ classes }} animate--text delay--{{ forloop.index0 }}">
              <div class="multicolumn--content_wrapper">
                {% if heading != blank %}
                  <h3 class="section-multicolumn__block-heading mb0">{{ heading }}</h3>
                {% endif %}
                {% if caption != blank %}
                  <div class="section-multicolumn__block-subheading rte mb0">
                    {{ caption }}
                  </div>
                {% endif %}
                {% if has_button %}
                  <a class="button mb0 mt1" href="{{ link }}">{{ button_text }}</a>
                {% endif %}
              </div>
            </div>
          {% endif %}
        </div>

      </article>
    {% endfor %}

    {% if section.blocks.size == 0 %}
      {% render 'onboard-no-blocks' %}
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Multicolumn",
  "tag": "section",
  "class": "dynamic-section",
  "max_blocks": 6,
  "settings": [
    {
      "type": "select",
      "id": "section_padding",
      "label": "Section spacing",
      "options": [
        {
          "value": "top",
          "label": "Top"
        },
        {
          "value": "bottom",
          "label": "Bottom"
        },
        {
          "value": "both",
          "label": "Both"
        },
        {
          "value": "none",
          "label": "None"
        }
      ],
      "default": "both",
      "visible_if": "{{ settings.section_padding > 0 }}"
    }
  ],
  "blocks": [
    {
      "type": "image_alongside_text",
      "name": "Image alongside text",
      "settings": [
        {
          "type": "select",
          "id": "block_width",
          "label": "Block width",
          "options": [
            {
              "value": "one_third",
              "label": "One third"
            },
            {
              "value": "half",
              "label": "Half"
            },
            {
              "value": "two_thirds",
              "label": "Two thirds"
            },
            {
              "value": "full",
              "label": "Full"
            }
          ],
          "default": "half"
        },
        {
          "type": "checkbox",
          "id": "two_rows",
          "label": "Double height",
          "default": false,
          "info": "Doubles the height if alongside blocks that have the same setting disabled."
        },
        {
          "type":"header",
          "content":"Image"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "select",
          "id": "image_height",
          "label": "Image height",
          "options": [
            {
              "value": "natural",
              "label": "Natural"
            },
            {
              "value": "small",
              "label": "Small"
            },
            {
              "value": "medium",
              "label": "Medium"
            },
            {
              "value": "large",
              "label": "Large"
            }
          ],
          "default": "natural"
        },
        {
          "type": "select",
          "id": "image_align",
          "label": "Image alignment",
          "options": [
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            }
          ],
          "default": "left"
        },
        {
          "type":"header",
          "content":"content"
        },
        {
          "type": "text_alignment",
          "id": "text_align",
          "label": "Text align",
          "default": "left"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Image alongside text"
        },
        {
          "type": "richtext",
          "id": "caption",
          "label": "Caption",
          "default": "<p>Caption content.</p>"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Button"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link",
          "info": "Optional"
        },
        {
          "type": "select",
          "id": "color_scheme",
          "label": "Color scheme",
          "default": "3",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "1",
              "label": "1"
            },
            {
              "value": "2",
              "label": "2"
            },
            {
              "value": "3",
              "label": "3"
            }
          ]
        }
      ]
    },
    {
      "type": "image_above_text",
      "name": "Image above text",
      "settings": [
        {
          "type": "select",
          "id": "block_width",
          "label": "Block width",
          "options": [
            {
              "value": "one_third",
              "label": "One third"
            },
            {
              "value": "half",
              "label": "Half"
            },
            {
              "value": "two_thirds",
              "label": "Two thirds"
            },
            {
              "value": "full",
              "label": "Full"
            }
          ],
          "default": "half"
        },
        {
          "type":"header",
          "content":"Image"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "select",
          "id": "image_height",
          "label": "Image height",
          "options": [
            {
              "value": "natural",
              "label": "Natural"
            },
            {
              "value": "small",
              "label": "Small"
            },
            {
              "value": "medium",
              "label": "Medium"
            },
            {
              "value": "large",
              "label": "Large"
            }
          ],
          "default": "natural"
        },
        {
          "type":"header",
          "content":"Image"
        },
        {
          "type": "text_alignment",
          "id": "text_align",
          "label": "Text align",
          "default": "left"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Image above text"
        },
        {
          "type": "richtext",
          "id": "caption",
          "label": "Caption",
          "default": "<p>Caption content.</p>"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Button"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link",
          "info": "Optional"
        },
        {
          "type": "select",
          "id": "color_scheme",
          "label": "Color scheme",
          "default": "3",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "1",
              "label": "1"
            },
            {
              "value": "2",
              "label": "2"
            },
            {
              "value": "3",
              "label": "3"
            }
          ]
        }
      ]
    },
    {
      "type": "image_floating_text",
      "name": "Image with floating text",
      "settings": [
        {
          "type": "select",
          "id": "block_width",
          "label": "Block width",
          "options": [
            {
              "value": "one_third",
              "label": "One third"
            },
            {
              "value": "half",
              "label": "Half"
            },
            {
              "value": "two_thirds",
              "label": "Two thirds"
            },
            {
              "value": "full",
              "label": "Full"
            }
          ],
          "default": "half"
        },
        {
          "type": "checkbox",
          "id": "two_rows",
          "label": "Double height",
          "default": false,
          "info": "Doubles the height if alongside blocks that have the same setting disabled."
        },
        {
          "type":"header",
          "content":"content"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "select",
          "id": "image_height",
          "label": "Image height",
          "options": [
            {
              "value": "natural",
              "label": "Natural"
            },
            {
              "value": "small",
              "label": "Small"
            },
            {
              "value": "medium",
              "label": "Medium"
            },
            {
              "value": "large",
              "label": "Large"
            }
          ],
          "default": "natural"
        },
        {
          "type": "color",
          "id": "overlay_color",
          "label": "Image overlay",
          "default": "#000"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "label": "Overlay opacity",
          "default": 0
        },
        {
          "type":"header",
          "content":"content"
        },
        {
          "type": "text_alignment",
          "id": "text_align",
          "label": "Text align",
          "default": "left"
        },
        {
          "type": "select",
          "id": "text_position",
          "label": "Text position",
          "options": [
            {
              "value": "top_left",
              "label": "Top left"
            },
            {
              "value": "top_center",
              "label": "Top center"
            },
            {
              "value": "top_right",
              "label": "Top right"
            },
            {
              "value": "center_left",
              "label": "Center left"
            },
            {
              "value": "center_center",
              "label": "Center center"
            },
            {
              "value": "center_right",
              "label": "Center right"
            },
            {
              "value": "bottom_left",
              "label": "Bottom left"
            },
            {
              "value": "bottom_center",
              "label": "Bottom center"
            },
            {
              "value": "bottom_right",
              "label": "Bottom right"
            }
          ],
          "default": "center_center"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Image with floating text"
        },
        {
          "type": "richtext",
          "id": "caption",
          "label": "Caption",
          "default": "<p>Caption content.</p>"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Button"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link",
          "info": "Optional"
        },
        {
          "type":"checkbox",
          "id":"caption_background_fill",
          "label":"Fill caption background",
          "default":false,
          "info":"Fill the caption background with the color scheme background"
        },
        {
          "type": "select",
          "id": "color_scheme",
          "label": "Color scheme",
          "default": "3",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "1",
              "label": "1"
            },
            {
              "value": "2",
              "label": "2"
            },
            {
              "value": "3",
              "label": "3"
            }
          ]
        }
      ]
    },
    {
      "type": "text",
      "name": "Text only",
      "settings": [
        {
          "type": "select",
          "id": "block_width",
          "label": "Block width",
          "options": [
            {
              "value": "one_third",
              "label": "One third"
            },
            {
              "value": "half",
              "label": "Half"
            },
            {
              "value": "two_thirds",
              "label": "Two thirds"
            },
            {
              "value": "full",
              "label": "Full"
            }
          ],
          "default": "half"
        },
        {
          "type": "text_alignment",
          "id": "text_align",
          "label": "Text align",
          "default": "left"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Text only"
        },
        {
          "type": "richtext",
          "id": "caption",
          "label": "Caption",
          "default": "<p>Caption content.</p>"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Button"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link",
          "info": "Optional"
        },
        {
          "type": "select",
          "id": "color_scheme",
          "label": "Color scheme",
          "default": "3",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "1",
              "label": "1"
            },
            {
              "value": "2",
              "label": "2"
            },
            {
              "value": "3",
              "label": "3"
            }
          ]
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Multicolumn",
      "blocks": [
        {
          "type": "image_alongside_text"
        },
        {
          "type": "image_alongside_text"
        },
        {
          "type": "text"
        },
        {
          "type": "text"
        },
        {
          "type": "image_floating_text"
        },
        {
          "type": "image_floating_text"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
